import os
import datetime


def create_index_yar(start_dir):
    current_datetime = datetime.datetime.now().strftime("%d-%m-%Y %H:%M:%S")
    with open("index.yar", "w") as index_file:
        index_file.write("/*\nGenerated by Raspirus\n")
        index_file.write(f"On {current_datetime}\n*/\n\n")

        total_files = 0
        yar_files = 0

        for root, dirs, files in os.walk(start_dir):
            for file in files:
                total_files += 1
                if (file.endswith(".yar") or file.endswith(".yara")) and not file.startswith("index.yar"):
                    yar_files += 1
                    relative_path = os.path.relpath(os.path.join(root, file), start=start_dir)
                    relative_path = relative_path.replace("\\", "/")  # Replace backslashes with forward slashes
                    index_file.write(f'include "./{relative_path}"\n')

            print(f"Processed {total_files} files, {yar_files} .yar/.yara files found", end='\r')


if __name__ == "__main__":
    current_folder = os.getcwd()
    create_index_yar(current_folder)
    print("\nIndexing complete!")
