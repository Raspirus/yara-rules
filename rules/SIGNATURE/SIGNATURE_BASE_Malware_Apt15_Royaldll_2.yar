import "pe"


import "pe"


rule SIGNATURE_BASE_Malware_Apt15_Royaldll_2 : FILE
{
	meta:
		description = "DNS backdoor used by APT15"
		author = "Ahmed Zaki"
		id = "3bc546a5-38b9-5504-b09e-305ba7bbd6bc"
		date = "2023-12-05"
		modified = "2023-12-05"
		reference = "https://github.com/Neo23x0/signature-base"
		source_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/yara/apt_apt15.yar#L245-L261"
		license_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/LICENSE"
		hash = "bc937f6e958b339f6925023bc2af375d669084e9551fd3753e501ef26e36b39d"
		logic_hash = "94e2b61ff19b1377f461203cb22c607e718683691e54a3de3ed32bf6ed2897fa"
		score = 75
		quality = 85
		tags = "FILE"

	strings:
		$ = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost" wide ascii
		$ = "netsvcs" wide ascii fullword
		$ = "%SystemRoot%\\System32\\svchost.exe -k netsvcs" wide ascii fullword
		$ = "SYSTEM\\CurrentControlSet\\Services\\" wide ascii
		$ = "myWObject" wide ascii

	condition:
		uint16(0)==0x5A4D and all of them and pe.exports("ServiceMain") and filesize >50KB and filesize <600KB
}