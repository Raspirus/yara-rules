rule SIGNATURE_BASE_APT_Greyenergy_Malware_Oct18_1 : FILE
{
	meta:
		description = "Detects samples from Grey Energy report"
		author = "Florian Roth (Nextron Systems)"
		id = "fc997540-075e-5f1c-9238-135c1572553b"
		date = "2018-10-17"
		modified = "2023-12-05"
		reference = "https://www.welivesecurity.com/2018/10/17/greyenergy-updated-arsenal-dangerous-threat-actors/"
		source_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/yara/apt_greyenergy.yar#L12-L29"
		license_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/LICENSE"
		logic_hash = "0cbdc156b7080608c1071feeb4826a70bb259c55139d74d019465c4bb5244260"
		score = 75
		quality = 85
		tags = "FILE"
		hash1 = "6c52a5850a57bea43a0a52ff0e2d2179653b97ae5406e884aee63e1cf340f58b"

	strings:
		$x1 = "%SystemRoot%\\System32\\thinmon.dll" fullword ascii
		$s2 = "'Cannot delete list entry (fatal error)!9The module %s cannot be executed on this system (0x%.4x).%Enumerate all sessions on TSE" wide
		$s8 = "cbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbecbe" ascii
		$s14 = "configure the service" fullword wide

	condition:
		uint16(0)==0x5a4d and filesize <700KB and pe.imphash()=="98d1ad672d0db4b4abdcda73cc9835cb" and all of them
}