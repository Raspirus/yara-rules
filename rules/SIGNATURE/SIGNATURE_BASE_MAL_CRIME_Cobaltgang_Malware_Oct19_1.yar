import "pe"


rule SIGNATURE_BASE_MAL_CRIME_Cobaltgang_Malware_Oct19_1 : FILE
{
	meta:
		description = "Detects CobaltGang malware"
		author = "Florian Roth (Nextron Systems)"
		id = "95c16016-b09b-56f3-b5a4-fca18ac70ad5"
		date = "2019-10-24"
		modified = "2023-12-05"
		reference = "https://twitter.com/vxsh4d0w/status/1187353649015611392"
		source_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/yara/crime_cobaltgang.yar#L74-L95"
		license_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/LICENSE"
		logic_hash = "4bd57aa6929b3eced7dee8063d89c542f2c80f802ef40efc23bbea6cc8ffd98c"
		score = 75
		quality = 85
		tags = "FILE"
		hash1 = "72125933265f884ceb8ab64ab303ea76aaeb7877faee8976d398acd0d0b7356b"
		hash2 = "893339624602c7b3a6f481aed9509b53e4e995d6771c72d726ba5a6b319608a7"
		hash3 = "3c34bbf641df25f9accd05b27b9058e25554fdfea0e879f5ca21ffa460ad2b01"

	strings:
		$op_a1 = { 0f 44 c2 eb 0a 31 c0 80 fa 20 0f 94 c0 01 c0 5d }
		$op_b1 = { 89 e5 53 8b 55 08 8b 4d 0c 8a 1c 01 88 1c 02 83 }
		$op_b2 = { 89 e5 53 8b 55 08 8b 45 0c 8a 1c 0a 88 1c 08 83 }

	condition:
		uint16(0)==0x5a4d and filesize <=2000KB and (pe.imphash()=="d1e3f8d02cce09520379e5c1e72f862f" or pe.imphash()=="8e26df99c70f79cb8b1ea2ef6f8e52ac" or ($op_a1 and 1 of ($op_b*)))
}