import "pe"


rule SIGNATURE_BASE_Malware_Apt15_Royalcli_1 : FILE
{
	meta:
		description = "Generic strings found in the Royal CLI tool"
		author = "David Cannings"
		id = "432c09bf-3c44-5a2c-ba69-7b4fe7eb43cc"
		date = "2023-12-05"
		modified = "2023-12-05"
		reference = "https://github.com/Neo23x0/signature-base"
		source_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/yara/apt_apt15.yar#L133-L152"
		license_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/LICENSE"
		hash = "6df9b712ff56009810c4000a0ad47e41b7a6183b69416251e060b5c80cd05785"
		logic_hash = "3cc0cd81db58e20fbf31fbd9fe65d113b7160e7d2b6739c01987d9e317099b9b"
		score = 75
		quality = 85
		tags = "FILE"

	strings:
		$ = "%s~clitemp%08x.tmp" fullword
		$ = "%s /c %s>%s" fullword
		$ = "%snewcmd.exe" fullword
		$ = "%shkcmd.exe" fullword
		$ = "%s~clitemp%08x.ini" fullword
		$ = "myRObject" fullword
		$ = "myWObject" fullword
		$ = "2 %s  %d 0 %d\x0D\x0A"
		$ = "2 %s  %d 1 %d\x0D\x0A"
		$ = "%s file not exist" fullword

	condition:
		uint16(0)==0x5A4D and 5 of them
}