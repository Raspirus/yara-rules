rule SIGNATURE_BASE_ME_Campaign_Malware_3 : FILE
{
	meta:
		description = "Detects malware from Middle Eastern campaign reported by Talos"
		author = "Florian Roth (Nextron Systems)"
		id = "d8bfd426-ff42-5332-8206-67a558509494"
		date = "2018-02-07"
		modified = "2023-12-05"
		reference = "http://blog.talosintelligence.com/2018/02/targeted-attacks-in-middle-east.html"
		source_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/yara/apt_middle_east_talosreport.yar#L50-L66"
		license_url = "https://github.com/Neo23x0/signature-base/blob/6b8e2a00e5aafcfcfc767f3f53ae986cf81f968a/LICENSE"
		logic_hash = "7d45f9f624285ed13a16901335585490459f22ef8af157c38b720118735ed432"
		score = 75
		quality = 85
		tags = "FILE"
		license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
		hash1 = "15f5aaa71bfa3d62fd558a3e88dd5ba26f7638bf2ac653b8d6b8d54dc7e5926b"

	strings:
		$x1 = "objWShell.Run \"powershell.exe -ExecutionPolicy Bypass -File \"\"%appdata%\"\"\\sys.ps1\", 0 " fullword ascii
		$x2 = "objFile.WriteLine \"New-Item -Path \"\"$ENV:APPDATA\\Microsoft\\Templates\"\" -ItemType Directory -Force }\" " fullword ascii
		$x3 = "objFile.WriteLine \"$path = \"\"$ENV:APPDATA\\Microsoft\\Templates\\Report.doc\"\"\" " fullword ascii
		$s4 = "File=appData & \"\\sys.ps1\"" fullword ascii

	condition:
		uint16(0)==0x6553 and filesize <400KB and 1 of them
}