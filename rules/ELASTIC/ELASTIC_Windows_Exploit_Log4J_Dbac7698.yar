rule ELASTIC_Windows_Exploit_Log4J_Dbac7698 : FILE MEMORY
{
	meta:
		description = "Detects Windows Exploit Log4J (Windows.Exploit.Log4j)"
		author = "Elastic Security"
		id = "dbac7698-906c-44a2-9795-f04ec07d7fcc"
		date = "2021-12-13"
		modified = "2022-01-13"
		reference = "https://github.com/elastic/protections-artifacts/"
		source_url = "https://github.com/elastic/protections-artifacts//blob/7607ac6ed3bb869356a16d2f7488f6744c68b134/yara/rules/Windows_Exploit_Log4j.yar#L1-L24"
		license_url = "https://github.com/elastic/protections-artifacts//blob/7607ac6ed3bb869356a16d2f7488f6744c68b134/LICENSE.txt"
		logic_hash = "b09d8dd9c422e7eb8aa23f8b1204d31fd290252925099300d6d19d73e562ca5e"
		score = 75
		quality = 75
		tags = "FILE, MEMORY"
		fingerprint = "cd06db6f5bebf0412d056017259b5451184d5ba5b2976efd18fa8f96dba6a159"
		severity = 100
		arch_context = "x86"
		scan_context = "file, memory"
		license = "Elastic License v2"
		os = "windows"

	strings:
		$jndi1 = "jndi.ldap.LdapCtx.c_lookup"
		$jndi2 = "logging.log4j.core.lookup.JndiLookup.lookup"
		$jndi3 = "com.sun.jndi.url.ldap.ldapURLContext.lookup"
		$exp1 = "Basic/Command/Base64/"
		$exp2 = "java.lang.ClassCastException: Exploit"
		$exp3 = "WEB-INF/classes/Exploit"
		$exp4 = "Exploit.java"

	condition:
		2 of ($jndi*) and 1 of ($exp*)
}