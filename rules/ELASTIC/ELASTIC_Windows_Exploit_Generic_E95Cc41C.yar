rule ELASTIC_Windows_Exploit_Generic_E95Cc41C : FILE
{
	meta:
		description = "Detects Windows Exploit Generic (Windows.Exploit.Generic)"
		author = "Elastic Security"
		id = "e95cc41c-6cad-4b9c-b647-3c60e6614e25"
		date = "2024-02-28"
		modified = "2024-06-12"
		reference = "https://github.com/elastic/protections-artifacts/"
		source_url = "https://github.com/elastic/protections-artifacts//blob/7607ac6ed3bb869356a16d2f7488f6744c68b134/yara/rules/Windows_Exploit_Generic.yar#L1-L32"
		license_url = "https://github.com/elastic/protections-artifacts//blob/7607ac6ed3bb869356a16d2f7488f6744c68b134/LICENSE.txt"
		hash = "4cce9e39c376f67c16df3bcd69efd9b7472c3b478e2e5ef347e1410f1105c38d"
		logic_hash = "9b620988a6ee84ed0cbb0fb0a3cca633fffc8e6369ed45455e9e1e6c021ea461"
		score = 75
		quality = 75
		tags = "FILE"
		fingerprint = "78f78de7cee54107ee7c3de9b152ce3a242c1408115ab0950ccdfc278ed15a19"
		severity = 100
		arch_context = "x86"
		scan_context = "file"
		license = "Elastic License v2"
		os = "windows"

	strings:
		$s1 = "Got system privileges" nocase
		$s2 = "Got SYSTEM token" nocase
		$s3 = "Got a SYSTEM token" nocase
		$s4 = "] Duplicating SYSTEM token" nocase
		$s5 = "] Token Stealing is successful" nocase
		$s6 = "] Exploit completed" nocase
		$s7 = "] Got SYSTEM shell." nocase
		$s8 = "] Spawning SYSTEM shell" nocase
		$s9 = "we have a SYSTEM shell!" nocase
		$s10 = "Dropping to System Shell." nocase
		$s11 = "] Enjoy the NT AUTHORITY\\SYSTEM shell" nocase
		$s12 = "] SMEP is disabled" nocase
		$s13 = "] KUSER_SHARED_DATA"
		$s14 = "] Found System EPROCESS"

	condition:
		any of them
}