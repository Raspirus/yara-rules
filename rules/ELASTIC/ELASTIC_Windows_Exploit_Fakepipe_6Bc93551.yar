
rule ELASTIC_Windows_Exploit_Fakepipe_6Bc93551 : FILE MEMORY
{
	meta:
		description = "Detects Windows Exploit Fakepipe (Windows.Exploit.FakePipe)"
		author = "Elastic Security"
		id = "6bc93551-b528-464b-8f1f-06db58c1cb01"
		date = "2024-02-28"
		modified = "2024-03-21"
		reference = "https://github.com/elastic/protections-artifacts/"
		source_url = "https://github.com/elastic/protections-artifacts//blob/7607ac6ed3bb869356a16d2f7488f6744c68b134/yara/rules/Windows_Exploit_FakePipe.yar#L1-L22"
		license_url = "https://github.com/elastic/protections-artifacts//blob/7607ac6ed3bb869356a16d2f7488f6744c68b134/LICENSE.txt"
		hash = "545a41ccfcd0a4f09c1c62bef2dde61b52fa92abada71ab72b3f4febb9265f75"
		logic_hash = "daf78c4a2db337f51054e108b5b54c8aa32300eae3bd39c5fc2d4769221c8aea"
		score = 75
		quality = 75
		tags = "FILE, MEMORY"
		fingerprint = "e2e31171486ee71bff9450966ba7b68dd0013856f1bda9ff7a30270855332c44"
		severity = 100
		arch_context = "x86"
		scan_context = "file, memory"
		license = "Elastic License v2"
		os = "windows"

	strings:
		$api = "ImpersonateNamedPipeClient"
		$s1 = "\\\\.\\pipe\\%ws\\pipe\\" wide nocase
		$s2 = "\\\\.\\pipe\\%s\\pipe\\" wide nocase
		$s3 = { 5C 00 5C 00 2E 00 5C 00 70 00 69 00 70 00 65 00 5C 00 00 19 5C 00 70 00 69 00 70 00 65 00 5C }

	condition:
		$api and any of ($s*)
}