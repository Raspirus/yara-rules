rule DITEKSHEN_MALWARE_Win_Deeprats : FILE
{
	meta:
		description = "Detects DeepRats ("
		author = "ditekSHen"
		id = "5b774e24-3864-519f-9cfd-d729d7d567a0"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L7188-L7218"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "511264c0b6932f90069a5206cd142ca7210b0bc40c51ef5aa9c41a161fb57aab"
		score = 75
		quality = 73
		tags = "FILE"
		hash1 = "1f8b7e1b14869d119c5de1f05330094899bd997fca4c322d852db85cbd9271e6"

	strings:
		$s1 = "https://freegeoip.live/json/https://myexternalip.com/rawin" ascii
		$s2 = "github.com/cretz/bine" ascii
		$s3 = "github.com/kbinani/screenshot" ascii
		$s4 = "socks5://%s:%d" ascii
		$s5 = "socks5://%s:%s@%s:%d" ascii
		$s6 = "http://%s:%d" ascii
		$s7 = "http://%s@%s:%d" ascii
		$s8 = "%SystemRoot%\\system32\\--CookieAuthentication" ascii
		$s9 = "tor_addr_" ascii
		$f1 = ".GetVnc" ascii
		$f2 = ".GetCommand" ascii
		$f3 = ".GetPayload" ascii
		$f4 = ".ListenCommands" ascii
		$f5 = ".ReceiveFile" ascii
		$f6 = ".RegisterImplant" ascii
		$f7 = ".Screenshot" ascii
		$f8 = ".SendFile" ascii
		$f9 = ".StartShell" ascii
		$f10 = ".UnregisterImplant" ascii
		$f11 = ".VncInstalled" ascii
		$f12 = ".PingPong" ascii
		$f13 = ".ListenCMD" ascii

	condition:
		uint16(0)==0x5a4d and (7 of ($s*) or 8 of ($f*))
}