rule DITEKSHEN_MALWARE_Win_Nworm : FILE
{
	meta:
		description = "Detects NWorm/N-W0rm payload"
		author = "ditekSHen"
		id = "06546ccf-8914-5b1c-942f-99664b9ecf44"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L3423-L3443"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "a1397a057422be260b5bdf1eb58571e95c259c132cc2518b39e1524a0eda9c66"
		score = 75
		quality = 75
		tags = "FILE"
		clamav_sig = "MALWARE.Win.Trojan.NWorm"

	strings:
		$id1 = "N-W0rm" ascii
		$id2 = "N_W0rm" ascii
		$x1 = "pongPing" fullword wide
		$x2 = "|NW|" fullword wide
		$s1 = "runFile" fullword wide
		$s2 = "runUrl" fullword wide
		$s3 = "killer" fullword wide
		$s4 = "powershell" fullword wide
		$s5 = "wscript.exe" fullword wide
		$s6 = "ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -File \"" fullword wide
		$s7 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36" fullword wide
		$s8 = "Start-Sleep -Seconds 1.5; Remove-Item -Path '" fullword wide

	condition:
		uint16(0)==0x5a4d and ((1 of ($id*) and (1 of ($x*) or 3 of ($s*))) or ( all of ($x*) and 2 of ($s*)) or 7 of ($s*) or 10 of them )
}