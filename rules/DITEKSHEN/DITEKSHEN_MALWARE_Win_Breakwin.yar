rule DITEKSHEN_MALWARE_Win_Breakwin : FILE
{
	meta:
		description = "Detects BreakWin Wiper"
		author = "ditekSHen"
		id = "4ffadbfa-c1cc-59e6-a9ba-7a34eca6c3fe"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L7453-L7471"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "86fc89e28fc107c2d4fe98dc16048d9e076b1fef53a3df0814f80a88bbe09c48"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "Started wiping file %s with %s." fullword wide
		$s2 = "C:\\Program Files\\Lock My PC" wide
		$s3 = "Stardust is still alive." fullword wide
		$s4 = "Failed to terminate the locker process." fullword wide
		$s5 = "C:\\Windows\\System32\\cmd.exe" fullword wide
		$s6 = "Process created successfully. Executed command: %s." fullword wide
		$s7 = "locker_background_image_path" fullword ascii
		$s8 = "takeown.exe /F \"C:\\Windows\\Web\\Screen\" /R /A /D Y" fullword ascii
		$s9 = "icacls.exe \"C:\\Windows\\Web\\Screen\" /reset /T" fullword ascii
		$s10 = "takeown.exe /F \"C:\\ProgramData\\Microsoft\\Windows\\SystemData\" /R /A /D Y" fullword ascii
		$s11 = ".?AVProcessSnapshotCreationFailedException@@" fullword ascii

	condition:
		uint16(0)==0x5a4d and 4 of them
}