import "pe"


rule DITEKSHEN_MALWARE_Win_Blackmatter : FILE
{
	meta:
		description = "Detects BlackMatter ransomware"
		author = "ditekSHen"
		id = "8883e652-edab-5cbf-a4fa-963b437447d9"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L7748-L7767"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "4558002b424f7102f67fc44dfc37ac20f6013e25ae827c6aee0fc37231e2fa72"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "C:\\Windows\\System32\\*.drv" fullword wide
		$s2 = "NYbr-Vk@" fullword ascii
		$s3 = ":7:=:H:Q:W:\\:b:&;O;^;v;" fullword ascii
		$o1 = { b0 34 aa fe c0 e2 fb b9 03 }
		$o2 = { fe 00 ff 75 08 ff 75 0c ff b5 d8 fe ff ff ff b5 }
		$o3 = { 6a 00 ff 75 0c ff b5 d8 fe ff ff ff b5 dc fe ff }
		$o4 = { ff 75 08 ff 75 0c ff b5 d8 fe ff ff ff b5 dc fe }
		$o5 = { 53 56 57 8d 85 70 ff ff ff 83 c0 0f 83 e0 f0 89 }
		$o6 = { c7 85 68 ff ff ff 00 04 00 00 8b 85 6c ff ff ff }

	condition:
		uint16(0)==0x5a4d and ( all of ($s*) and all of ($o*))
}