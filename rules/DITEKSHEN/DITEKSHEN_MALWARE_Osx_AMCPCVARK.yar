import "pe"


rule DITEKSHEN_MALWARE_Osx_AMCPCVARK : FILE
{
	meta:
		description = "Detects OSX TechyUtils/PCVARK adware"
		author = "ditekSHen"
		id = "1378364b-db10-5194-98f8-5347504a92e6"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L3114-L3139"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "b18a9f578af98feb5107d9ef85850457ba5921ab58af7b097a815e3af74f05f7"
		score = 75
		quality = 75
		tags = "FILE"
		clamav_sig = "MALWARE.Osx.Adware.AMC-PCVARK-TechyUtils"

	strings:
		$s1 = "Mac Auto Fixer.app" fullword ascii
		$s2 = "com.techyutil.macautofixer" fullword ascii
		$s3 = "com.findApp.findApp" ascii
		$s4 = "Library/Preferences/%@.plist" fullword ascii
		$s5 = "Library/%@/%@" fullword ascii
		$s6 = "Library/Application Support/%@/%@" fullword ascii
		$s7 = "sleep 3; rm -rf \"%@\"" fullword ascii
		$s8 = "Silently calling url: %@" ascii
		$cnc1 = "cloudfront.net/getdetails" ascii
		$cnc2 = "trk.entiretrack.com/trackerwcfsrv/tracker.svc/trackOffersAccepted/?" ascii
		$cnc3 = "pxl=%@&x-count=1&utm_source=%@&lpid=0&utm_content=&utm_term=&x-base=&utm_medium=%@&utm_publisher=%@&offerpxl=&x-fetch=1&utm_campaign=@&affiliateid=&x-at=&btnid=" ascii
		$x1 = "mafsysinfo" fullword ascii
		$x2 = "MAF4497_MAF4399_MAF2204" ascii
		$developerid = "Developer ID Application: Rahul Gahlot (RZ74UYT742)" ascii

	condition:
		uint16(0)==0xfacf and (6 of ($s*) or 2 of ($cnc*) or all of ($x*) or $developerid)
}