import "pe"


rule DITEKSHEN_MALWARE_Win_Unknown_Packedloader_01 : FILE
{
	meta:
		description = "Detects unknown loader / packer. Observed running LummaStealer"
		author = "ditekShen"
		id = "2969090f-dff9-5745-b87d-a031741dd2e0"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L10844-L10863"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "6fd9075793b55e04c68bb13d21b88741889a9c37a0a9d1a19d895c7b68af4506"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "Error at hooking API \"%S\"" wide
		$s2 = "Dumping first %d bytes:" wide
		$s3 = "Error at initialization of bundled DLL: %s" wide
		$s4 = "GetMemoryForDLL()" ascii
		$s5 = "type=activation&code=" ascii
		$s6 = "activation.php?code=" ascii
		$s7 = "&hwid=" ascii
		$s8 = "&hash=" ascii
		$s9 = "type=deactivation&hash=" ascii
		$s10 = "deactivation.php?hash=" ascii
		$s11 = "BANNED" fullword ascii
		$s12 = "GetAdaptersInfo" ascii

	condition:
		uint16(0)==0x5a4d and 11 of them
}