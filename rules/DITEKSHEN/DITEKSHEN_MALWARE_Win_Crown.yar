import "pe"


rule DITEKSHEN_MALWARE_Win_Crown : FILE
{
	meta:
		description = "Detects Crown Tech Support Scam"
		author = "ditekSHen"
		id = "ac4551d0-a574-5287-9b37-899c736db792"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L8191-L8211"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "eeb36993c93d76ed118643ee417f15e1768015f72464dbabca7ae001f64a0aef"
		score = 75
		quality = 75
		tags = "FILE"
		snort_sid = "920251-920261"

	strings:
		$d1 = "//prodownload.live" ascii
		$c1 = "&uid=" ascii
		$c2 = "&ver=" ascii
		$c3 = "&mcid=" ascii
		$c4 = ".php?uid=" ascii
		$c5 = ".php?ip=" ascii
		$s1 = "Operating System Support ID:" ascii
		$s2 = "taskkill /IM explorer.exe -f" ascii nocase
		$s3 = "/C taskkill /IM Taskmgr.exe -f" ascii nocase
		$s4 = "FastSuport" fullword ascii
		$s5 = "Support Override!" fullword wide
		$s6 = "Support Assistance Override Activated!" fullword wide

	condition:
		uint16(0)==0x5a4d and ( all of ($c*) or 4 of ($s*) or (1 of ($d*) and (3 of ($c*) or 2 of ($s*))))
}