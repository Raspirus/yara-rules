rule DITEKSHEN_MALWARE_Win_Sn0Wlogger : FILE
{
	meta:
		description = "Detects Sn0w Logger"
		author = "ditekSHen"
		id = "cdb70164-3f72-553f-a6c5-190f699e0743"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L4412-L4428"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "ea4b2281f906271dc249b5036b22eadfc5add94def4f8e4f8a40c384618465d8"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "\\SnowP\\Example\\Secured\\" ascii
		$s2 = "{0}{3}Content-Type: {4}{3}Content-Disposition: form-data; name=\"{1}\"{3}{3}{2}{3}" wide
		$s3 = "\"encrypted_key\":\"(.*?)\"" fullword wide
		$s4 = "<SendToDiscord>d__" ascii
		$s5 = "_urlWebhook" ascii
		$r1 = "[\\w-]{24}\\.[\\w-]{6}\\.[\\w-]{27}" fullword wide
		$r2 = "^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$" fullword wide
		$r3 = "mfa\\.[\\w-]{84}" fullword wide
		$r4 = "(\\w+)=(\\d+)-(\\d+)$" fullword wide

	condition:
		uint16(0)==0x5a4d and (4 of ($s*) or ( all of ($r*) and 2 of ($s*)) or 7 of them )
}