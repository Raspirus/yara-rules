rule DITEKSHEN_MALWARE_Win_Tefosteal : FILE
{
	meta:
		description = "Tefosteal payload"
		author = "ditekSHen"
		id = "56646933-3ed3-5b77-9135-993b57603490"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L653-L674"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "a350863270cbe3349f271e55d66a2ebdd6406e8d122c11071de74a774eb77ebf"
		score = 75
		quality = 71
		tags = "FILE"
		clamav_sig = "MALWARE.Win.Trojan.Tefosteal"

	strings:
		$s1 = "netsh wlan show networks mode=bssid" nocase fullword wide
		$s2 = "LoginCredentialService.GetLoginCredentials$" ascii
		$s3 = "DefaultLoginCredentials.LoginEventUsrPw$" ascii
		$s4 = "SEC_E_NO_KERB_KEY" wide
		$s5 = "TList<System.Zip.TZipHeader>." ascii
		$s6 = "_Password.txt" fullword wide nocase
		$s7 = "_Cookies.txt" fullword wide nocase
		$f1 = "\\InfoPC\\BSSID.txt" wide
		$f2 = "\\Files\\Telegram\\" wide
		$f3 = "\\InfoPC\\Screenshot.png" wide
		$f4 = "\\InfoPC\\Systeminfo.txt" wide
		$f5 = "\\Steam\\config" wide
		$f6 = "\\delete.vbs" wide

	condition:
		uint16(0)==0x5a4d and 4 of ($s*) and 2 of ($f*)
}