import "pe"


rule DITEKSHEN_MALWARE_Win_Wshratplugin : FILE
{
	meta:
		description = "WSHRAT keylogger plugin payload"
		author = "ditekSHen"
		id = "45c4fc87-6c45-5cd7-9fc4-7d3ea664a740"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L1668-L1685"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "3feeab43b58b533b7d2d41a71f2107e6f05b9c54ff805607843d253cadbe9384"
		score = 75
		quality = 75
		tags = "FILE"
		snort_sid = "920010-920012"
		clamav_sig = "MALWARE.Win.Trojan.WSHRAT-KLG"

	strings:
		$s1 = "GET /open-keylogger HTTP/1.1" fullword wide
		$s2 = "KeyboardChange: nCode={0}, wParam={1}, vkCode={2}, scanCode={3}, flags={4}, dwExtraInfo={6}" wide
		$s3 = "MouseChange: nCode={0}, wParam={1}, x={2}, y={3}, mouseData={4}, flags={5}, dwExtraInfo={7}" wide
		$s4 = "sendKeyLog" fullword ascii
		$s5 = "saveKeyLog" fullword ascii
		$s6 = "get_TotalKeyboardClick" fullword ascii
		$s7 = "get_SessionMouseClick" fullword ascii
		$pdb = "\\Android\\documents\\visual studio 2010\\Projects\\Keylogger\\Keylogger\\obj\\x86\\Debug\\Keylogger.pdb" ascii

	condition:
		uint16(0)==0x5a4d and filesize <100KB and 4 of them
}