rule DITEKSHEN_MALWARE_Win_Gravityrat : FILE
{
	meta:
		description = "Detects GravityRAT"
		author = "ditekSHen"
		id = "cb581dd6-15b2-54ae-9f27-30ec21554fb9"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L6086-L6108"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "a6b049dbf21f22f751c15da98536e9ef2a4ced7755ade0cc9904afddef1d3ae6"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "/GX/GX-Server.php?VALUE=2&Type=" wide
		$s2 = "&SIGNATUREHASH=" wide
		$s3 = "Error => CommonFunctionClass => Upload()" wide
		$s4 = "/GetActiveDomains.php" wide
		$s5 = "DetectVM" ascii wide
		$s6 = "/c {0} > {1}" wide
		$s7 = "DRIVEUPLOADCOMPLETED => TOTALFILES={0}, FILESUPLOADED={1}" wide
		$s8 = "Program => RunAFile()" wide
		$s9 = "DoViaCmd" ascii
		$s10 = ".msoftupdates.com:" wide
		$f1 = "<RootJob>b__" ascii
		$f2 = "<GetFiles>b__" ascii
		$f3 = "<UpdateServer>b__" ascii
		$f4 = "<EthernetId>b__" ascii
		$f5 = "<MatchMacAdd>b__" ascii

	condition:
		uint16(0)==0x5a4d and (5 of ($s*) or ( all of ($f*) and 1 of ($s*)))
}