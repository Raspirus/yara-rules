import "pe"


rule DITEKSHEN_MALWARE_Win_Horuseyesrat : FILE
{
	meta:
		description = "Detects HorusEyesRAT"
		author = "ditekSHen"
		id = "80b2fd11-f8b4-5aee-b55a-4f7ee9fad6cf"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L7435-L7451"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "c0f499e3a17923b391ed6b7fa723525a9d4aef0ce04a2c7abec60d5eda15888f"
		score = 75
		quality = 73
		tags = "FILE"

	strings:
		$x1 = "\\HorusEyesRat-" ascii
		$x2 = "\\HorusEyesRat.pdb" ascii
		$x3 = "get_horus_eye" ascii
		$s1 = "get_Type_Packet" fullword ascii
		$s2 = "PacketLib" fullword ascii nocase
		$s3 = "System.Net.Sockets" fullword ascii
		$s4 = "PROCESS_MODE_BACKGROUND_BEGIN" fullword ascii
		$s5 = "EXECUTION_STATE" fullword ascii
		$s6 = /Plugins\\[A-Z]{2}.dll/ fullword wide

	condition:
		uint16(0)==0x5a4d and (2 of ($x*) or (1 of ($x*) and 3 of ($s*)) or (4 of ($s*) and #s6>4))
}