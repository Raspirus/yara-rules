import "pe"


rule DITEKSHEN_MALWARE_Win_Klackring : FILE
{
	meta:
		description = "Detects Klackring variants. Associated with ZINC / Lazarus"
		author = "ditekSHen"
		id = "7bd9a68f-d58b-5437-a28b-5a7f1a11038e"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L4461-L4475"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "b894e89de720affadd80966d726a44ffce75d71095b0530edb6bfddb76660c54"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "%s\\%s.dll" fullword wide
		$s2 = "cmd.exe /c move /Y %s %s" fullword wide
		$s3 = "%s\\win32k.sys" fullword wide
		$s4 = "NetSvcInst_Rundll32.dll" fullword ascii
		$s5 = "Spectrum.dll" fullword ascii wide
		$s6 = "%s\\cmd.exe" fullword wide
		$s7 = ".?AVA5Stream@@" fullword ascii

	condition:
		uint16(0)==0x5a4d and 6 of them
}