rule DITEKSHEN_MALWARE_Win_Gasket : FILE
{
	meta:
		description = "Detects Gasket"
		author = "ditekSHen"
		id = "3afa131d-9c88-50df-a3b4-552db4a84e69"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L7220-L7250"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "0279979915891fc8c813ba555120ee5705b53b234a808b5ca77bff35a082e376"
		score = 75
		quality = 73
		tags = "FILE"

	strings:
		$s1 = "main.checkGasket" ascii
		$s2 = "main.connectGasket" ascii
		$s3 = "/cert/trust/dev/stderr/dev/stdout/index.html" ascii
		$f1 = ".SetPingHandler." ascii
		$f2 = ".SetPongHandler." ascii
		$f3 = ".computeMergeInfo." ascii
		$f4 = ".computeDiscardInfo." ascii
		$f5 = ".readPlatformMachineID." ascii
		$f6 = ".(*Session).establishStream." ascii
		$f7 = ".(*Session).handleGoAway." ascii
		$f8 = ".(*Stream).processFlags." ascii
		$f9 = ".(*Session).handlePing." ascii
		$f10 = ".(*windowsService).Install." ascii
		$f11 = ".(*windowsService).Uninstall." ascii
		$f12 = ".(*windowsService).Status." ascii
		$f13 = ".getStopTimeout." ascii
		$f14 = ".DialContext." ascii
		$f15 = ".WriteControl." ascii
		$f16 = ".(*Server).authenticate." ascii
		$f17 = ".(*Server).ServeConn." ascii
		$f18 = ".(*TCPProxy).listen." ascii
		$f19 = ".UserPassAuthenticator.Authenticate." ascii
		$f20 = ".(*InfoPacket).XXX_" ascii

	condition:
		uint16(0)==0x5a4d and ( all of ($s*) or 16 of ($f*))
}