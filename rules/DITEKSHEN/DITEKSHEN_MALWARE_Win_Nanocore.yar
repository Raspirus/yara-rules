rule DITEKSHEN_MALWARE_Win_Nanocore : FILE
{
	meta:
		description = "Detects NanoCore"
		author = "ditekSHen"
		id = "931b98f6-df2b-538b-bc49-ecbbd24334da"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L7654-L7681"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "6336260e0af2b4b51338ee066f41b7c58aa134a6c03ca110db7e088edf2b65a7"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$x1 = "NanoCore Client" fullword ascii
		$x2 = "NanoCore.ClientPlugin" fullword ascii
		$x3 = "NanoCore.ClientPluginHost" fullword ascii
		$i1 = "IClientApp" fullword ascii
		$i2 = "IClientData" fullword ascii
		$i3 = "IClientNetwork" fullword ascii
		$i4 = "IClientAppHost" fullword ascii
		$i5 = "IClientDataHost" fullword ascii
		$i6 = "IClientLoggingHost" fullword ascii
		$i7 = "IClientNetworkHost" fullword ascii
		$i8 = "IClientUIHost" fullword ascii
		$i9 = "IClientNameObjectCollection" fullword ascii
		$i10 = "IClientReadOnlyNameObjectCollection" fullword ascii
		$s1 = "ClientPlugin" fullword ascii
		$s2 = "EndPoint" fullword ascii
		$s3 = "IPAddress" fullword ascii
		$s4 = "IPEndPoint" fullword ascii
		$s5 = "IPHostEntr" fullword ascii
		$s6 = "get_ClientSettings" fullword ascii
		$s7 = "get_Connected" fullword ascii

	condition:
		uint16(0)==0x5a4d and (2 of ($x*) or 8 of ($i*) or all of ($s*) or (1 of ($x*) and (3 of ($i*) or 2 of ($s*))))
}