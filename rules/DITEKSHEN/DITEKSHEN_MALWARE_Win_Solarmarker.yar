import "pe"


rule DITEKSHEN_MALWARE_Win_Solarmarker : FILE
{
	meta:
		description = "Detects SolarMarker"
		author = "ditekSHen"
		id = "78c2f739-76b2-5a80-8b9a-6c677d578eaa"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L10745-L10763"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "84182c8948c2f40439cd932885ae8b88bb677ecc9fba366f22d30e13dc4ffb68"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$x1 = "token_type" fullword ascii
		$x2 = "request_data" fullword ascii
		$x3 = "request_timeout" fullword ascii
		$x4 = { 74 6f 6b 65 6e 73 00 66 72 6f 6d 00 74 6f 00 73 5f (66|72) }
		$s1 = "set_UseShellExecute" fullword ascii
		$s2 = "<Select>b__0" fullword ascii
		$s3 = "<get>b__e" fullword ascii
		$s4 = "<get>b__10" fullword ascii
		$s5 = "<get>b__f" fullword ascii
		$s6 = "<set>b__0" fullword ascii
		$s7 = "<set>b__1" fullword ascii

	condition:
		uint16(0)==0x5a4d and ( all of ($x*) and 4 of ($s*))
}