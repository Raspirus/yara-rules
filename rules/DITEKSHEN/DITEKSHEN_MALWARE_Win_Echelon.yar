rule DITEKSHEN_MALWARE_Win_Echelon : FILE
{
	meta:
		description = "Echelon information stealer payload"
		author = "ditekSHen"
		id = "e13d2003-c755-5dd3-bb16-8e41dd19a151"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L936-L957"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "c070bf52cc51dd334ea24614e33eaa2b7b1a17e7790e586cbbb8c7e33ba1bd76"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "<GetStealer>b__" ascii
		$s2 = "clearMac" fullword ascii
		$s3 = "path2save" fullword ascii
		$s4 = "Echelon_Size" fullword ascii
		$s5 = "Echelon Stealer by" wide
		$s6 = "get__masterPassword" fullword ascii
		$s7 = "DomainDetect" fullword ascii
		$s8 = "[^\\u0020-\\u007F]" fullword wide
		$s9 = "/sendDocument?chat_id=" wide
		$s10 = "//setting[@name='Password']/value" wide
		$s11 = "Passwords_Mozilla.txt" fullword wide
		$s12 = "Passwords_Edge.txt" fullword wide
		$s13 = "@madcod" ascii wide
		$pdb = "\\Echelon-Stealer-master\\obj\\Release\\Echelon.pdb" ascii

	condition:
		( uint16(0)==0x5a4d and (8 of ($s*) or $pdb)) or (8 of ($s*) or $pdb)
}