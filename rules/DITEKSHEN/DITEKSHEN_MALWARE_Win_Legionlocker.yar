import "pe"


rule DITEKSHEN_MALWARE_Win_Legionlocker : FILE
{
	meta:
		description = "Detects LegionLocker ransomware"
		author = "ditekSHen"
		id = "4e5c50d0-808e-5adb-bce9-804ddf66ca61"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L5111-L5129"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "2da897b5603415f14fff134b3a94d77e6963da79e117d26ba16e6b04e45f4045"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$m1 = "+Do not run task manager, powershell, cmd etc." ascii wide
		$m2 = "3 hours your files will be deleted." ascii wide
		$m3 = "files have been encrypted by Legion Locker" ascii wide
		$s1 = "passwordBytes" fullword ascii
		$s2 = "_start_enc_" ascii
		$s3 = "_del_desktop_" ascii
		$s4 = "Processhacker" wide
		$s5 = "/k color 47 && del /f /s /q %userprofile%\\" wide
		$s6 = "Submit code" fullword wide
		$pdb1 = "\\obj\\Debug\\LegionLocker.pdb" ascii
		$pdb2 = "\\obj\\Release\\LegionLocker.pdb" ascii

	condition:
		uint16(0)==0x5a4d and (1 of ($m*) or 1 of ($pdb*) or 4 of ($s*))
}