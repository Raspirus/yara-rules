rule DITEKSHEN_MALWARE_Win_Truebot : FILE
{
	meta:
		description = "Detects TrueBot"
		author = "ditekSHen"
		id = "7210a0bd-d310-55bf-bb0c-14cadb59bd67"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L9825-L9845"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "a92141ef0aa7d68b3594a0f56c0370498fe5751a472c9011ac8b92ae46e88e53"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "%s\\rundll32.exe" fullword wide
		$s2 = "ChkdskExs" fullword wide
		$s3 = "n=%s&o=%s&a=%d&u=%s&p=%s&d=%s" ascii
		$s4 = "KLLS" fullword ascii
		$s5 = "%s\\%08x-%08x.ps1" fullword ascii
		$s6 = ".JSONIP" ascii
		$s7 = "CreateProcessAsUserW res %d err %d" fullword ascii
		$s8 = "ldr_sys64.dll" fullword ascii
		$s9 = "SVCHOST" fullword ascii
		$s10 = "WINLOGON" fullword ascii
		$s11 = { 67 6f 6f 67 6c 65 2e 63 6f 6d 00 00 00 00 00 00 
                2f 00 63 00 20 00 64 00 65 00 6c 00 20 00 00 00 
                20 00 3e 00 3e 00 20 00 4e 00 55 00 4c 00 }

	condition:
		uint16(0)==0x5a4d and 6 of them
}