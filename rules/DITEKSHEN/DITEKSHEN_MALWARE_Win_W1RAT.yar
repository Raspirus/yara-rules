rule DITEKSHEN_MALWARE_Win_W1RAT : FILE
{
	meta:
		description = "W1 RAT payload"
		author = "ditekSHen"
		id = "d5841bc0-97e7-575e-91f6-d264f507a8b5"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L569-L585"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "84b9a2e309ed9ab0fb8343d941585356d23348683073d0a37fc7194f58a43a0e"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "/c /Ox /Fa\"%s/%s.asm\" /Fo\"%s/%s.obj\" \"%s/%s.%s\"" ascii
		$s2 = "this->piProcInfo.hProcess" fullword ascii
		$s3 = "index >= 0 && index < this->reg_tab->GetLen()" fullword ascii
		$s4 = "strcpy(log_font.lfFaceName,\"%s\");" fullword ascii
		$s5 = "WorkShop -- [%s]" fullword ascii
		$s6 = "HeaderFile.cpp" fullword ascii
		$s7 = "WndLog.cpp" fullword ascii
		$s8 = "assertion fail \"%s\" at file=%s line=%d" fullword ascii
		$s9 = "Stdin   pipe   creation   failed" fullword ascii

	condition:
		( uint16(0)==0x5a4d and 6 of ($s*)) or ( all of them )
}