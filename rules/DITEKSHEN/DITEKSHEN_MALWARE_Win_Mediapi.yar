rule DITEKSHEN_MALWARE_Win_Mediapi : FILE
{
	meta:
		description = "Detects MediaPI"
		author = "ditekSHen"
		id = "95db8772-1bcd-5eea-956c-c9578b8e1329"
		date = "2024-05-28"
		modified = "2024-05-28"
		reference = "https://github.com/ditekshen/detection"
		source_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/yara/malware.yar#L11443-L11457"
		license_url = "https://github.com/ditekshen/detection/blob/2ddbbe14eea1f342bca2cfd09a643a40ae2fcaf6/LICENSE.txt"
		logic_hash = "2bce0a96b45e46c0cbd913dacb3dfe7ae1b519102d637e0fd9dabe2008037d94"
		score = 75
		quality = 75
		tags = "FILE"

	strings:
		$s1 = "SomeFunction" ascii
		$s2 = "\"stealth" ascii
		$s3 = "\"ServAddr" ascii
		$s4 = "\"ServPort" ascii
		$s5 = "\"ServIp" ascii
		$s6 = "\"wsaData" ascii
		$s7 = "\"-socket" ascii

	condition:
		uint16(0)==0x5a4d and pe.is_dll() and ((6 of them ) or (3 of them and pe.exports("SomeFunction")))
}