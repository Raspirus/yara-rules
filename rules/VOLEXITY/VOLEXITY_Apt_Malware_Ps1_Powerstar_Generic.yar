rule VOLEXITY_Apt_Malware_Ps1_Powerstar_Generic : CHARMINGCYPRESS FILE MEMORY
{
	meta:
		description = "Detects POWERSTAR modules based on common HTTP functions used across modules."
		author = "threatintel@volexity.com"
		id = "71a3e99d-e1c8-5ac1-abbc-2ba5cba80799"
		date = "2023-06-02"
		modified = "2023-06-28"
		reference = "https://github.com/volexity/threat-intel"
		source_url = "https://github.com/volexity/threat-intel/blob/cb213e6d64022494a2ae7a9e65dfbf254a99b144/2024/2024-02-13 CharmingCypress/rules.yar#L311-L335"
		license_url = "https://github.com/volexity/threat-intel/blob/cb213e6d64022494a2ae7a9e65dfbf254a99b144/LICENSE.txt"
		logic_hash = "4da02190ffd16304eccbc0d12dfcc5637a6b785af0e3dc3dfcafcfe114597eb2"
		score = 75
		quality = 80
		tags = "CHARMINGCYPRESS, FILE, MEMORY"
		scan_context = "file,memory"
		license = "See license at https://github.com/volexity/threat-intel/blob/main/LICENSE.txt"
		rule_id = 9356
		version = 2

	strings:
		$http1 = "Send_Upload" ascii wide
		$http2 = "Send_Post_Data" ascii wide
		$json1 = "{\"OS\":\"" ascii wide
		$json2 = "{\"ComputerName\":\"' + $env:COMPUTERNAME + '\"}" ascii wide
		$json3 = "{\"Token\"" ascii wide
		$json4 = "{\"num\":\"" ascii wide

	condition:
		all of ($http*) or all of ($json*)
}