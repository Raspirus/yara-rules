
rule R3C0NST_ATM_Malware_Dispcashbr : FILE
{
	meta:
		description = "Detects ATM Malware DispCashBR"
		author = "Frank Boldewin (@r3c0nst)"
		id = "17d22120-0ca2-5b27-9816-21ab4a6fb20c"
		date = "2020-02-27"
		modified = "2020-08-17"
		reference = "https://twitter.com/r3c0nst/status/1232944566208286720"
		source_url = "https://github.com/fboldewin/YARA-rules//blob/54e9e6899b258b72074b2b4db6909257683240c2/ATM.Malware.DispCashBR.yar#L1-L21"
		license_url = "N/A"
		logic_hash = "3fb5d62cb779ddc13e9b938290dfa9d2a3353d7969e639a662c1bcaca945de4d"
		score = 75
		quality = 90
		tags = "FILE"
		hash1 = "7cea6510434f2c8f28c9dbada7973449bb1f844cfe589cdc103c9946c2673036"

	strings:
		$String1 = "(*) Dispensando: %lu" ascii nocase
		$String2 = "COMANDO EXECUTADO COM SUCESSO" ascii nocase
		$String3 = "[+] FOI SACADO:  %lu R$ [+]" ascii nocase
		$DbgStr1 = "_Get_Information_cdm_cuinfo" ascii nocase
		$DbgStr2 = "_GET_INFORMATION_SHUTTER" ascii nocase
		$Code1 = {C7 44 24 08 00 00 00 00 C7 44 24 04 2F 01 00 00 89 04 24 E8}
		$Code2 = {C7 44 24 08 00 00 00 00 C7 44 24 04 17 05 00 00 89 04 24 E8}
		$Code3 = {89 4C 24 08 C7 44 24 04 2E 01 00 00 89 04 24 E8}

	condition:
		uint16(0)==0x5A4D and filesize <100KB and 2 of ($String*) and 1 of ($DbgStr*) and all of ($Code*)
}