import "hash"


rule R3C0NST_ATM_Malware_NVISOSPIT : FILE
{
	meta:
		description = "Detects ATM Malware NVISOSPIT"
		author = "Frank Boldewin (@r3c0nst)"
		id = "faf9e78e-9d7a-5c9b-a08e-90b895333d5c"
		date = "2019-05-31"
		modified = "2019-05-31"
		reference = "https://twitter.com/r3c0nst/status/1134403094157115392"
		source_url = "https://github.com/fboldewin/YARA-rules//blob/54e9e6899b258b72074b2b4db6909257683240c2/ATM.Malware.NVISOSPIT.yar#L3-L18"
		license_url = "N/A"
		hash = "d7ce7b152f0da49e96fa32a9336b35253905d9940b001288d0df55d8f8b3951f"
		logic_hash = "11c1fea74b72a7821ce76a95846a2caff7354e71906496d9530cb44339a49a98"
		score = 75
		quality = 90
		tags = "FILE"

	strings:
		$MalwareName = "NVISOSPIT" ascii fullword
		$DispenseCommand = "Calling WFSExecute() to dispense $%d" fullword ascii
		$Code = {C6 85 7D F9 FF FF 4D C6 85 7E F9 FF FF 4D C6 85 7F F9 FF FF 4B}

	condition:
		uint16(0)==0x5A4D and filesize <100KB and 2 of them
}