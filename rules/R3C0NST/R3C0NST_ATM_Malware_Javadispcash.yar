rule R3C0NST_ATM_Malware_Javadispcash : FILE
{
	meta:
		description = "Detects ATM Malware JavaDispCash"
		author = "Frank Boldewin (@r3c0nst)"
		id = "606d1cb6-7879-569e-ac36-1e2f6a446dc1"
		date = "2019-03-28"
		modified = "2019-03-28"
		reference = "https://twitter.com/r3c0nst/status/1111254169623674882"
		source_url = "https://github.com/fboldewin/YARA-rules//blob/54e9e6899b258b72074b2b4db6909257683240c2/ATM.Mal.JavaDispCash.yar#L1-L20"
		license_url = "N/A"
		logic_hash = "dd7c2ccc85038f3ba563f7f814c03668448b292fde36bcf9d06bf20fd341526f"
		score = 75
		quality = 74
		tags = "FILE"
		hash1 = "0149667c0f8cbfc216ef9d1f3154643cbbf6940e6f24a09c92a82dd7370a5027"
		hash2 = "ef407db8c79033027858364fd7a04eeb70cf37b7c3a10069a92bae96da88dfaa"

	strings:
		$CashInfo = "getNumberOfCashUnits" nocase ascii wide
		$Dispense = "waitforbillstaken" nocase ascii wide
		$Inject = "No code to inject!" nocase ascii wide
		$config = ".Agentcli" nocase ascii wide
		$log1 = "logft.log" nocase ascii wide
		$log2 = ".loginside" nocase ascii wide

	condition:
		uint16(0)==0x4B50 and filesize <500KB and all of them
}