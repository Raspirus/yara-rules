
rule R3C0NST_ATM_Malware_XFS_ALICE : FILE
{
	meta:
		description = "Detects ATM Malware ALICE"
		author = "Frank Boldewin (@r3c0nst)"
		id = "6132730c-4684-517a-b90d-98ed250e2cba"
		date = "2020-01-09"
		modified = "2020-08-17"
		reference = "https://twitter.com/r3c0nst/status/1215265889844637696"
		source_url = "https://github.com/fboldewin/YARA-rules//blob/54e9e6899b258b72074b2b4db6909257683240c2/ATM.Malware.ALICE.yar#L1-L22"
		license_url = "N/A"
		logic_hash = "7dca049f024f09c2e778b0693a1015d1fc5a006fc564de914e85231cb5d73da3"
		score = 75
		quality = 90
		tags = "FILE"
		hash1 = "6b2fac8331e4b3e108aa829b297347f686ade233b24d94d881dc4eff81b9eb30"

	strings:
		$String1 = "Project Alice" ascii nocase
		$String2 = "Can't dispense requested amount." ascii nocase
		$String3 = "Selected cassette is unavailable" ascii nocase
		$String4 = "ATM update manager" wide nocase
		$String5 = "Input PIN-code for access" wide nocase
		$String6 = "Supervisor ID" wide nocase
		$Code1 = {50 68 08 07 00 00 6A 00 FF 75 0C FF 75 08 E8}
		$Code2 = {50 6A 00 FF 75 10 FF 75 0C FF 75 08 E8}
		$Code3 = {68 ?? ?? ?? ?? 53 E8 ?? ?? ?? ?? 0B C0 75 29 6A}

	condition:
		uint16(0)==0x5A4D and filesize <200KB and 4 of ($String*) and all of ($Code*)
}